<div class="products-container">
  <div class='row pb-3 align-items-center'>
    <h5 class='col-4'><%= t('agency.products.title', default: 'Products') %></h5>
    <div class='col-8 pe-4'>
      <%= search_form_for @q, url: agency_products_path, method: :get, html: { class: 'd-flex gap-2' } do |f| %>
        <%= f.text_field :name_cont, placeholder: 'Product Name', class: 'form-control' %>
        <%= f.submit 'Search', class: 'btn btn-primary' %>
      <% end %>
    </div>
  </div>

  <ul class="nav nav-tabs">
    <li class="nav-item">
      <%= link_to agency_products_path,
        class: "nav-link nav-tab #{'active' unless params.dig(:q, :is_active_eq) == 'false'}" do %>
        Active Products
      <% end %>
    </li>
    <li class="nav-item">
      <%= link_to agency_products_path(q: { is_active_eq: false }),
        class: "nav-link nav-tab #{'active' if params.dig(:q, :is_active_eq) == 'false'}" do %>
        Inactive Products
      <% end %>
    </li>
  </ul>

  <table class='table table-striped text-center align-middle mt-3'>
    <thead>
      <tr>
        <th>ID</th>
        <th class="text-start">Product Name</th>
        <th>Brand</th>
        <th>Category</th>
        <th>Stock</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody class='table-group-divider'>
      <% if @products.present? %>
        <% @products.each do |product| %>
          <tr>
            <td><%= product.id %></td>
            <td class="text-start"><%= product.name %></td>
            <td><%= product.product_brand&.name || 'N/A' %></td>
            <td><%= product.category&.name || 'N/A' %></td>
            <td>
              <% stock = product.product_variants.sum { |v| v.product_stocks.sum(&:stock_quantity) } %>
              <span class="badge <%= stock > 0 ? 'bg-success' : 'bg-danger' %>">
                <%= stock %>
              </span>
            </td>
            <td>
              <% if product.is_active %>
                <span class="badge bg-success">Active</span>
              <% else %>
                <span class="badge bg-secondary">Inactive</span>
              <% end %>
            </td>
            <td>
              <%= link_to 'View', agency_product_path(product), class: 'btn btn-sm btn-info' %>
            </td>
          </tr>
        <% end %>
      <% else %>
        <tr>
          <td class='text-center' colspan='7'><%= t('agency.products.no_products', default: 'No products found') %></td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <%= render 'layouts/admin/pagination', paging_collection: @products %>
</div>
